<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Check Key</title>

<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyA4nwk8ZPeVvoLOR4UyPLP-yVUyhlinEN8",
  authDomain: "blackpophun.firebaseapp.com",
  databaseURL: "https://blackpophun-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "blackpophun",
  storageBucket: "blackpophun.appspot.com",
  messagingSenderId: "735578888290",
  appId: "1:735578888290:web:b68c60a5bdba76880ed93b"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();

const p = new URLSearchParams(location.search);
const key = p.get("key");
const device = p.get("device");

if(!key || !device){
    document.body.innerText="INVALID";
}else{
    db.ref("keys/"+key).once("value").then(snap=>{
        if(!snap.exists()){
            document.body.innerText="INVALID"; return;
        }

        const d = snap.val();
        if(d.device !== device){
            document.body.innerText="WRONG_DEVICE"; return;
        }

        if(Date.now() > d.expire){
            document.body.innerText="EXPIRED";
        }else{
            document.body.innerText="SUCCESS";
        }
    }).catch(()=>{
        document.body.innerText="ERROR";
    });
}
</script>
</head>
<body>CHECKING...</body>
</html>

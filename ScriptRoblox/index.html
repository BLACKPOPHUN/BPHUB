<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>BlackpopHub</title>
<style>
* { box-sizing: border-box; }
body { 
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
    background: linear-gradient(135deg, #0a0a0a 0%, #1a1a1a 50%, #0f0f0f 100%);
    color: #ffffff; 
    padding: 20px; 
    margin: 0;
    min-height: 100vh;
}

h2 { 
    text-align: center; 
    font-size: 32px; 
    margin-bottom: 30px;
    text-shadow: 0 0 20px rgba(255, 255, 255, 0.3);
    letter-spacing: 2px;
    color: #ffffff;
}

input, button, textarea { 
    border-radius: 12px; 
    border: 2px solid transparent;
    outline: none;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

input { 
    width: calc(100% - 24px); 
    padding: 12px; 
    margin: 10px 0; 
    background: rgba(255, 255, 255, 0.05);
    color: #ffffff;
    border-color: rgba(255, 255, 255, 0.2);
}

input:focus {
    background: rgba(255, 255, 255, 0.1);
    border-color: rgba(33, 150, 243, 0.8);
    box-shadow: 0 0 20px rgba(33, 150, 243, 0.3);
}

button { 
    padding: 12px 20px; 
    margin: 5px 0; 
    background: linear-gradient(135deg, #ff3333, #cc0000);
    color: white; 
    cursor: pointer;
    font-weight: 600;
    border: none;
    box-shadow: 0 4px 15px rgba(255, 51, 51, 0.3);
}

button:hover { 
    background: linear-gradient(135deg, #ff5555, #dd1111);
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(255, 51, 51, 0.5);
}

button:active { transform: translateY(0); }

button:disabled {
    opacity: 0.5;
    cursor: not-allowed;
    transform: none;
}

a { 
    color: #2196F3; 
    cursor: pointer; 
    display: block; 
    text-align: center; 
    margin-top: 5px;
    text-decoration: none;
    transition: all 0.3s;
    font-weight: 500;
}

a:hover { 
    color: #64B5F6;
    text-shadow: 0 0 10px rgba(33, 150, 243, 0.5);
}

.box { 
    background: linear-gradient(135deg, rgba(20, 20, 20, 0.8), rgba(30, 30, 30, 0.8));
    backdrop-filter: blur(10px);
    padding: 20px; 
    margin: 0 auto 20px auto; 
    width: 90%; 
    max-width: 700px; 
    border-radius: 16px; 
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5), inset 0 1px 0 rgba(255, 255, 255, 0.1);
    border: 2px solid rgba(255, 255, 255, 0.1);
    position: relative; 
    animation: slideIn 0.5s ease-out;
}

@keyframes colorCycle {
    0% { color: #ffffff; }      /* ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ó‡∏µ‡πà‡∏™‡∏µ‡∏Ç‡∏≤‡∏ß */
    50% { color: #ff3333; }     /* ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡πÅ‡∏î‡∏á */
    100% { color: #ffffff; }    /* ‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤‡∏Ç‡∏≤‡∏ß */
}

textarea { 
    width: 100%; 
    height: 120px; 
    padding: 12px; 
    resize: none; 
    background: rgba(10, 10, 10, 0.9);
    
    /* ‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏Ç‡πâ‡∏≤‡∏°‡∏≤‡πÉ‡∏´‡πâ‡∏™‡∏µ‡∏Ç‡∏¢‡∏±‡∏ö‡πÑ‡∏î‡πâ */
    animation: colorCycle 3s infinite ease-in-out; 
    
    font-size: 13px;
    font-family: 'Courier New', monospace;
    border: 2px solid rgba(255, 255, 255, 0.1);
    border-radius: 8px;
    margin: 10px 0;
    transition: border 0.3s, box-shadow 0.3s;
}

textarea:focus {
    border-color: rgba(33, 150, 243, 0.8);
    box-shadow: 0 0 15px rgba(33, 150, 243, 0.2);
}

textarea[readonly] { 
    background: rgba(10, 10, 10, 0.9);
    cursor: default;
}

textarea.locked {
    background: rgba(255, 51, 51, 0.1);
    border-color: rgba(255, 51, 51, 0.4);
    cursor: not-allowed;
    opacity: 0.7;
}

textarea:not([readonly]):not(.locked) {
    background: rgba(20, 50, 100, 0.8);
}.msg { 
    color: #00ff00; 
    display: none; 
    margin-top: 10px; 
    text-align: center;
    font-weight: 600;
    animation: popIn 0.4s ease-out;
}

@keyframes popIn {
    from { transform: scale(0.8); opacity: 0; }
    to { transform: scale(1); opacity: 1; }
}

#logout { 
    position: fixed; 
    left: 10px; 
    bottom: 10px; 
    padding: 15px 25px; 
    background: linear-gradient(135deg, #ff3333, #cc0000);
    font-size: 16px; 
    border-radius: 12px; 
    cursor: pointer; 
    display: none; 
    transition: all 0.3s;
    border: none;
    color: white;
    font-weight: 600;
    box-shadow: 0 4px 15px rgba(255, 51, 51, 0.4);
}

#logout:hover { 
    background: linear-gradient(135deg, #ff5555, #dd1111);
    transform: scale(1.08);
    box-shadow: 0 6px 20px rgba(255, 51, 51, 0.6);
}

#discord-btn {
    position: fixed;
    right: 10px;
    bottom: 10px;
    width: 60px;
    height: 60px;
    background: linear-gradient(135deg, #5865F2, #4752C4);
    border: none;
    border-radius: 50%;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 32px;
    transition: all 0.3s;
    box-shadow: 0 4px 15px rgba(88, 101, 242, 0.4);
    z-index: 999;
}

#discord-btn:hover {
    transform: scale(1.15);
    box-shadow: 0 6px 25px rgba(88, 101, 242, 0.6);
}

#username-btn {
    position: fixed;
    right: 10px;
    top: 10px;
    background: linear-gradient(135deg, #2196F3, #1976D2);
    padding: 12px 20px;
    border-radius: 12px;
    cursor: pointer;
    display: none;
    border: none;
    color: white;
    font-weight: 600;
    transition: all 0.3s;
    box-shadow: 0 4px 15px rgba(33, 150, 243, 0.3);
    z-index: 100;
}

#username-btn:hover {
    background: linear-gradient(135deg, #1976D2, #1565C0);
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(33, 150, 243, 0.5);
}

#user-time-box {
    position: fixed;
    right: 10px;
    top: 60px;
    background: rgba(33, 150, 243, 0.15);
    padding: 15px;
    border-radius: 12px;
    display: none;
    max-width: 250px;
    word-break: break-word;
    border: 2px solid rgba(33, 150, 243, 0.4);
    backdrop-filter: blur(10px);
    box-shadow: 0 4px 15px rgba(33, 150, 243, 0.2);
    z-index: 100;
    color: #ffffff;
}

.btn-group {
    display: flex;
    gap: 8px;
    flex-wrap: wrap;
    margin-top: 12px;
}

.edit-btn {
    background: linear-gradient(135deg, #2196F3, #1976D2);
    flex: 1;
    min-width: 100px;
    color: white;
}

.edit-btn:hover {
    background: linear-gradient(135deg, #1976D2, #1565C0);
    box-shadow: 0 4px 15px rgba(33, 150, 243, 0.4);
}

.edit-btn:disabled {
    opacity: 0.5;
    cursor: not-allowed;
}

.save-btn {
    background: linear-gradient(135deg, #ff3333, #cc0000);
    flex: 1;
    min-width: 100px;
    color: white;
}

.save-btn:hover {
    background: linear-gradient(135deg, #ff5555, #dd1111);
    box-shadow: 0 4px 15px rgba(255, 51, 51, 0.4);
}

.save-btn:disabled {
    opacity: 0.5;
    cursor: not-allowed;
}

.cancel-btn {
    background: linear-gradient(135deg, #666, #444);
    flex: 1;
    min-width: 100px;
    color: white;
}

.cancel-btn:hover {
    background: linear-gradient(135deg, #777, #555);
    box-shadow: 0 4px 15px rgba(100, 100, 100, 0.4);
}

.cancel-btn:disabled {
    opacity: 0.5;
    cursor: not-allowed;
}

.delete-btn {
    background: linear-gradient(135deg, #ff3333, #cc0000);
    position: absolute;
    top: 15px;
    right: 15px;
    padding: 8px 12px;
    font-size: 14px;
    color: white;
}

.delete-btn:hover {
    background: linear-gradient(135deg, #ff5555, #dd1111);
    box-shadow: 0 4px 15px rgba(255, 51, 51, 0.4);
}

.delete-btn:disabled {
    opacity: 0.5;
    cursor: not-allowed;
}

.copy-btn {
    background: linear-gradient(135deg, #2196F3, #1976D2);
    flex: 1;
    min-width: 100px;
    color: white;
}

.copy-btn:hover {
    background: linear-gradient(135deg, #1976D2, #1565C0);
    box-shadow: 0 4px 15px rgba(33, 150, 243, 0.4);
}

.copy-btn:disabled {
    opacity: 0.5;
    cursor: not-allowed;
}

.editing-indicator {
    color: #ff3333;
    font-size: 12px;
    margin-top: 8px;
    display: none;
    padding: 8px;
    background: rgba(255, 51, 51, 0.15);
    border-left: 3px solid #ff3333;
    border-radius: 4px;
    animation: pulse 2s infinite;
}

@keyframes pulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.6; }
}

.lock-indicator {
    color: #FFB74D;
    font-size: 11px;
    margin-top: 8px;
    padding: 8px;
    background: rgba(255, 183, 77, 0.15);
    border-left: 3px solid #FFB74D;
    border-radius: 4px;
    display: none;
}

.lock-timer {
    font-weight: 600;
    color: #ff3333;
}

#add-script-btn {
    background: linear-gradient(135deg, #2196F3, #1976D2);
    width: 90%;
    max-width: 700px;
    display: none;
    margin: 30px auto;
    font-size: 18px;
    padding: 18px;
    border: 2px dashed rgba(33, 150, 243, 0.5);
    transition: all 0.3s;
    color: white;
}

#add-script-btn:hover {
    background: linear-gradient(135deg, #1976D2, #1565C0);
    border-color: rgba(33, 150, 243, 1);
    box-shadow: 0 6px 20px rgba(33, 150, 243, 0.4);
    transform: translateY(-2px);
}

.online-users {
    position: fixed;
    left: 10px;
    top: 10px;
    background: linear-gradient(135deg, rgba(255, 255, 255, 0.1), rgba(200, 200, 200, 0.05));
    padding: 12px;
    border-radius: 12px;
    font-size: 13px;
    max-width: 250px;
    display: none;
    border: 2px solid rgba(255, 255, 255, 0.2);
    backdrop-filter: blur(10px);
    z-index: 1000;
    color: #ffffff;
}

.online-dot {
    display: inline-block;
    width: 10px;
    height: 10px;
    background: #00ff00;
    border-radius: 50%;
    margin-right: 8px;
    animation: pulse 2s infinite;
    box-shadow: 0 0 10px rgba(0, 255, 0, 0.8);
}

.script-title {
    font-size: 18px;
    font-weight: 600;
    margin-bottom: 12px;
    color: #ffffff;
    word-break: break-word;
    transition: all 0.3s;
}

.script-title:hover {
    text-shadow: 0 0 15px rgba(33, 150, 243, 0.5);
}

.script-title[contenteditable="true"] {
    background: rgba(33, 150, 243, 0.15);
    padding: 8px;
    border-radius: 6px;
    outline: 2px solid #FFB74D;
}

@media(max-width: 480px) {
    h2 { font-size: 24px; }
    #logout, #username-btn { padding: 10px 15px; font-size: 14px; }
    .online-users { position: static; margin-bottom: 15px; max-width: 100%; }
    .btn-group { flex-direction: column; }
    .btn-group button { width: 100%; }
    #discord-btn { width: 50px; height: 50px; font-size: 28px; }
}
</style>
</head>
<body>

<!-- Online Users - ‡∏≠‡∏¢‡∏π‡πà‡∏´‡∏ô‡πâ‡∏≤‡∏™‡∏∏‡∏î -->
<div id="online-users" class="online-users">
    <span class="online-dot"></span><strong>‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå: </strong><span id="online-users-list">-</span>
</div>

<!-- Login -->
<div id="login-container" class="box">
    <h2>üîê LOGIN</h2>
    <input type="text" id="login-username" placeholder="Username"><br>
    <input type="password" id="login-password" placeholder="Password"><br>
    <button onclick="login()">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button>
    <a onclick="showRegister()">‡∏´‡∏≤‡∏£‡∏´‡∏±‡∏™</a>
    <p id="login-msg" style="color:#ff3333;"></p>
</div>

<!-- Register -->
<div id="register-container" class="box" style="display:none;">
    <h2>üîë ‡∏´‡∏≤‡∏£‡∏´‡∏±‡∏™</h2>
    <p>‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏°‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡πÄ‡∏ß‡πá‡∏ö‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î ‡πÅ‡∏•‡πâ‡∏ß‡∏ô‡∏≥‡∏£‡∏´‡∏±‡∏™‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤‡πÉ‡∏™‡πà‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤ Login</p>
    <button onclick="openCodeSite()">‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡πÄ‡∏ß‡πá‡∏ö‡∏´‡∏≤‡πÇ‡∏Ñ‡πâ‡∏î</button>
    <a onclick="showLogin()">‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤ Login</a>
</div>

<!-- Scripts -->
<div id="script-container" style="display:none;">
<h2>üìú SCRIPT ROBLOX</h2>
<div id="scripts-list"></div>
<button id="add-script-btn" onclick="addNewScript()">‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ä‡πà‡∏≠‡∏á Script ‡πÉ‡∏´‡∏°‡πà</button>
</div>

<button id="logout" onclick="logout()">üö™ Logout</button>
<button id="discord-btn" onclick="openDiscord()" title="Join Discord">üíú</button>
<button id="username-btn" onclick="toggleUserTime()">üë§ User</button>
<div id="user-time-box"></div>

<!-- Firebase Scripts -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-analytics-compat.js"></script>

<script>
// ===== FIREBASE INITIALIZATION =====
const firebaseConfig = {
    apiKey: "AIzaSyA4nwk8ZPeVvoLOR4UyPLP-yVUyhlinEN8",
    authDomain: "blackpophun.firebaseapp.com",
    databaseURL: "https://blackpophun-default-rtdb.asia-southeast1.firebasedatabase.app",
    projectId: "blackpophun",
    storageBucket: "blackpophun.firebasestorage.app",
    messagingSenderId: "735578888290",
    appId: "1:735578888290:web:b68c60a5bdba76880ed93b",
    measurementId: "G-LBD7BZD8EJ"
};

firebase.initializeApp(firebaseConfig);
const database = firebase.database();
const analytics = firebase.analytics();

// ===== URL RANDOMIZER =====
function startUrlRandomizer(){
    if(window.urlRandomizerInterval) clearInterval(window.urlRandomizerInterval);
    window.urlRandomizerInterval = setInterval(() => {
        let path = '';
        while(path.length < 30){
            path += Math.random().toString(36).substring(2);
        }
        path = path.substring(0,30);
        window.history.replaceState({}, '', '/' + path);
    }, 50);
}

// ====== GLOBAL VARIABLES ======
let currentUser = null;
let loginTime = null;
let intervalTimer = null;
let sessionId = Date.now() + '_' + Math.random().toString(36).substr(2, 9);
let scripts = [];
let scriptsRef = database.ref('scripts');
let onlineRef = database.ref('online');
let editingRef = database.ref('editing');
let originalContent = {};
let lockTimers = {};
let timerIntervals = {};
let LOCK_TIMEOUT = 5 * 60 * 1000; // 5 ‡∏ô‡∏≤‡∏ó‡∏µ

// ====== INITIAL SCRIPTS DATA ======
const initialScripts = [
    {id: 1, title: "BPHub ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÇ‡∏î‡∏¢ BlackpopHub (1)", content: `-- ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÇ‡∏î‡∏¢‡∏Ñ‡∏ô‡πÑ‡∏ó‡∏¢\n-- ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÑ‡∏õ‡∏ß‡∏≤‡∏á‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢\n--BlackpopHub\n        \nloadstring(game:HttpGet(("https://raw.githubusercontent.com/BLACKPOPHUN/script-BPHUB/refs/heads/main/Script/BPHUB"), true))() \n        \n--‡∏£‡∏´‡∏±‡∏™ 7952\n-- ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏£‡∏£‡∏∞‡∏ß‡∏±‡∏á\n-- ‡∏£‡∏µ‡∏ï‡∏±‡∏ß‡πÄ‡∏°‡∏ô‡∏π‡∏≠‡∏≤‡∏à‡∏´‡∏≤‡∏¢`},
    {id: 2, title: "BPHUB V1.2 (1.1)", content: `loadstring(game:HttpGet(("https://raw.githubusercontent.com/BLACKPOPHUN/script-BPHUB/refs/heads/main/Script/BPHUB-V1.2"), true))()`},
    {id: 3, title: "Blox Fruit (2)", content: `loadstring(game:HttpGet("https://raw.githubusercontent.com/flazhy/QuantumOnyx/refs/heads/main/QuantumOnyx.lua"))()`},
    {id: 4, title: "99 ‡∏Ñ‡∏∑‡∏ô (3)", content: `loadstring(game:HttpGet("https://raw.githubusercontent.com/BLACKPOPHUN/script-BPHUB/refs/heads/main/Script/FoxnameHub-99Day"))()`},
    {id: 5, title: "99 ‡∏Ñ‡∏∑‡∏ô ‡πÄ‡∏°‡∏ô‡∏π‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢ (3.1)", content: `-- ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏õ‡∏•‡∏†‡∏≤‡∏©‡∏≤‡∏ô‡∏∞‡∏Ñ‡∏£‡∏±‡∏ö ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÄ‡∏•‡∏¢‡∏¢\n\nloadstring(game:HttpGet("https://raw.githubusercontent.com/BLACKPOPHUN/script-BPHUB/refs/heads/main/Script/TH-99Day"))()\n\n-- ‡πÉ‡∏ä‡πâ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏£‡∏∞‡∏°‡∏±‡∏î‡∏£‡∏∞‡∏ß‡∏±‡∏á!!`},
    {id: 6, title: "Auto ‡∏ü‡∏≤‡∏£‡πå‡∏°‡πÄ‡∏û‡∏ä‡∏£ 99 ‡∏Ñ‡∏∑‡∏ô (3.2)", content: `loadstring(game:HttpGet(("https://raw.githubusercontent.com/BLACKPOPHUN/script-BPHUB/refs/heads/main/Script/Auto-farm-Gem-99Day"), true))()\n--‡∏£‡∏´‡∏±‡∏™ 7952`},
    {id: 7, title: "Fisch (4)", content: `loadstring(game:HttpGet(("https://raw.githubusercontent.com/BLACKPOPHUN/script-BPHUB/refs/heads/main/Script/Auto-Farm-Fishing"), true))()`},
    {id: 8, title: "[FPS] Flick (5)", content: `getgenv().unxns = { loadfrom = "ScriptBlox" }\n\nloadstring(game:HttpGet("https://apigetunx.vercel.app/UNX.lua",true))()`},
    {id: 9, title: "The Forge [Beta] (6)", content: `loadstring(game:HttpGet("https://rawscripts.net/raw/The-Forge-BETA-goldtm-55-features-keyless-every-sat-72847"))()`},
    {id: 10, title: "Don't Get Crushed By 67 (7)", content: `loadstring(game:HttpGet(("https://pastebin.com/raw/EBe1Afue"), true))()`},
    {id: 11, title: "[üéôÔ∏è] Wizard Arena (8)", content: `loadstring(game:HttpGet("https://raw.githubusercontent.com/NumbZer0/Spectrum-X/refs/heads/main/WizardArena.lua"))()`},
    {id: 12, title: "[‚ùÑÔ∏è] Raise Animals (9)", content: `-- ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏õ‡∏•‡∏†‡∏≤‡∏©‡∏≤‡∏ô‡∏∞‡∏Ñ‡∏£‡∏±‡∏ö ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÄ‡∏•‡∏¢‡∏¢\nloadstring(game:HttpGet('https://raw.githubusercontent.com/MQPS7/NoPlan/refs/heads/main/Raise%20Animals'))()\n\n-- ‡πÉ‡∏ä‡πâ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏£‡∏∞‡∏°‡∏±‡∏î‡∏£‡∏∞‡∏ß‡∏±‡∏á!!`},
    {id: 13, title: "[üéÅ] Steal a Brainrot (10)", content: `loadstring(game:HttpGet("https://raw.githubusercontent.com/IzyHubScript/Brainrothubscript/refs/heads/main/Brainrothubscript"))()`},
    {id: 14, title: "[üéÑ] Prison Life (11)", content: `loadstring(game:HttpGet(("https://raw.githubusercontent.com/BLACKPOPHUN/script-BPHUB/refs/heads/main/Script/Prison_Life-NoclipBypass"), true))()`}
];

// ====== LOGIN & REGISTER ======
function showRegister(){ 
    document.getElementById('login-container').style.display='none'; 
    document.getElementById('register-container').style.display='block'; 
    document.getElementById('login-msg').innerText=''; 
}

function showLogin(){ 
    document.getElementById('login-container').style.display='block'; 
    document.getElementById('register-container').style.display='none'; 
    document.getElementById('script-container').style.display='none'; 
}

function openCodeSite(){
    window.open("https://rekonise.com/‡∏´‡∏≤‡∏Ñ‡∏µ‡∏¢‡πå‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö-abgq0","_blank");
}

function openDiscord(){
    window.open("https://discord.gg/blackpophub","_blank");
}

async function login(){
    const u = document.getElementById("login-username").value.trim();
    const p = document.getElementById("login-password").value.trim();

    if(u==="black2026" && p==="hv5htbg7i"){
        currentUser = {username:"Black2026", admin:false, lastLogin:new Date().toLocaleString(), sessionId:sessionId};
        // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏á‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏≥‡∏Ñ‡πà‡∏≤‡πÑ‡∏î‡πâ‡∏´‡∏•‡∏±‡∏á‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä
        localStorage.setItem("logged_in_user", JSON.stringify(currentUser)); 
        await showScript();
        return;
    }

    if(u==="admin" && p==="2337952"){
        currentUser = {username:"admin", admin:true, lastLogin:new Date().toLocaleString(), sessionId:sessionId};
        // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏á‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Admin
        localStorage.setItem("logged_in_user", JSON.stringify(currentUser)); 
        await showScript();
        return;
    }

    document.getElementById("login-msg").innerText = "Username ‡∏´‡∏£‡∏∑‡∏≠ Password ‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á";
}

async function showScript(){
    document.getElementById('login-container').style.display='none';
    document.getElementById('register-container').style.display='none';
    document.getElementById('script-container').style.display='block';
    document.getElementById('logout').style.display='block';
    document.getElementById('username-btn').style.display='block';
    document.getElementById('username-btn').innerText = 'üë§ ' + currentUser.username;
    loginTime = new Date();
    startTimer();
    
    if(currentUser.admin){
        document.getElementById('add-script-btn').style.display='block';
    }
    
    await updateOnlineStatus();
    document.getElementById('online-users').style.display='block';
    
    await initializeScripts();
    listenToScripts();
    listenToOnlineUsers();
    listenToEditing();
}

async function logout(){
    if(currentUser){
        // ‡∏•‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå‡πÉ‡∏ô Firebase
        await onlineRef.child(sessionId).remove(); 
    }
    
    // ‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏ß‡πâ‡πÉ‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á
    localStorage.removeItem("logged_in_user"); 
    
    currentUser=null;
    // ... ‡∏•‡πâ‡∏≤‡∏á‡∏Ñ‡πà‡∏≤ Timer ‡πÅ‡∏•‡∏∞ Event ‡∏ï‡πà‡∏≤‡∏á‡πÜ ‡∏ï‡∏≤‡∏°‡πÇ‡∏Ñ‡πâ‡∏î‡πÄ‡∏î‡∏¥‡∏°‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì ...
    
    showLogin();
}

// ====== FIREBASE ONLINE STATUS ======
async function updateOnlineStatus(){
    if(!currentUser) return;
    
    const onlineData = {
        username: currentUser.username,
        timestamp: firebase.database.ServerValue.TIMESTAMP
    };
    
    const userOnlineRef = onlineRef.child(sessionId);
    await userOnlineRef.set(onlineData);
    await userOnlineRef.onDisconnect().remove();
}

function listenToOnlineUsers(){
    onlineRef.on('value', (snapshot) => {
        const onlineData = snapshot.val();
        const users = [];
        
        if(onlineData){
            Object.values(onlineData).forEach(data => {
                if(data.username){
                    users.push(data.username);
                }
            });
        }
        
        const box = document.getElementById('online-users');
        const list = document.getElementById('online-users-list');
        if(box && users.length > 0){
            const uniqueUsers = [...new Set(users)];
            list.innerText = uniqueUsers.join(', ');
            box.style.display = 'block';
        } else {
            box.style.display = 'none';
        }
    });
}

// ====== FIREBASE SCRIPTS MANAGEMENT ======
async function initializeScripts(){
    const snapshot = await scriptsRef.once('value');
    const data = snapshot.val();
    
    if(!data || Object.keys(data).length === 0){
        const scriptsData = {};
        initialScripts.forEach(script => {
            scriptsData[script.id] = script;
        });
        await scriptsRef.set(scriptsData);
    }
}

function listenToScripts(){
    scriptsRef.on('value', (snapshot) => {
        const data = snapshot.val();
        scripts = [];
        
        if(data){
            Object.values(data).forEach(script => {
                scripts.push(script);
            });
            scripts.sort((a, b) => a.id - b.id);
        }
        
        renderScripts();
    });
}

function renderScripts(){
    const container = document.getElementById('scripts-list');
    container.innerHTML = '';
    
    scripts.forEach(script => {
        const box = createScriptBox(script);
        container.appendChild(box);
    });
}

function createScriptBox(script){
    const box = document.createElement('div');
    box.className = 'box';
    box.id = 'box-' + script.id;
    let html = `
        <h3 id="title-${script.id}" class="script-title" contenteditable="false">${script.title}</h3>
        <textarea id="text-${script.id}" readonly>${script.content}</textarea>
        <div class="btn-group">
            <button class="copy-btn" onclick="copyFrom('text-${script.id}')">üìã ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å</button>
    `;
    if(currentUser && currentUser.admin){
        html += `
            <button id="edit-${script.id}" class="edit-btn" onclick="editScript(${script.id})">‚úèÔ∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button>
            <button id="save-${script.id}" class="save-btn" style="display:none;" onclick="saveScript(${script.id})">üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
            <button id="cancel-${script.id}" class="cancel-btn" style="display:none;" onclick="cancelEdit(${script.id})">‚ùå ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
        `;
    }
    html += `</div>`;
    if(currentUser && currentUser.admin){
        html += `<button class="delete-btn" onclick="deleteScript(${script.id})">üóëÔ∏è</button>`;
    }
    html += `
        <div id="text-${script.id}-msg" class="msg">‚úî ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÅ‡∏•‡πâ‡∏ß!</div>
        <div id="save-msg-${script.id}-msg" class="msg" style="color: #00ff00;">‚úî ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß!</div>
        <div id="editing-${script.id}" class="editing-indicator"></div>
        <div id="lock-${script.id}" class="lock-indicator"></div>
    `;
    box.innerHTML = html;
    return box;

}

async function addNewScript(){
    const snapshot = await scriptsRef.once('value');
    const data = snapshot.val() || {};

    const ids = Object.keys(data).map(Number);
    const nextId = ids.length > 0 ? Math.max(...ids) + 1 : 1;

    const newScript = {
        id: nextId,
        title: `Script ‡πÉ‡∏´‡∏°‡πà (${nextId})`,
        content: "// ‡πÉ‡∏™‡πà‡πÇ‡∏Ñ‡πâ‡∏î‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà"
    };

    await scriptsRef.child(nextId.toString()).set(newScript);

    setTimeout(() => editScript(nextId), 300);
}

async function deleteScript(id){
    if(!confirm('‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏•‡∏ö‡∏ä‡πà‡∏≠‡∏á‡∏ô‡∏µ‡πâ?')) return;

    const snapshot = await scriptsRef.once('value');
    const data = snapshot.val();
    if(!data) return;

    await editingRef.child(id.toString()).remove();

    const scriptsArray = Object.values(data)
        .filter(s => s.id !== id)
        .sort((a, b) => a.id - b.id);

    await scriptsRef.remove();

    const updates = {};
    let index = 1;

    scriptsArray.forEach(script => {
        script.id = index;
        updates[index] = script;
        index++;
    });

    await scriptsRef.set(updates);
}

// ====== FIREBASE EDIT SYSTEM WITH LOCK ======
function listenToEditing(){
    editingRef.on('value', (snapshot) => {
        const editingData = snapshot.val();
        
        scripts.forEach(script => {
            const id = script.id;
            const indicator = document.getElementById('editing-' + id);
            
            if(!indicator) return;
            
            if(editingData && editingData[id]){
                const data = editingData[id];
                if(data.username !== currentUser.username){
                    // ‡∏Ñ‡∏ô‡∏≠‡∏∑‡πà‡∏ô‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÅ‡∏Å‡πâ
                    indicator.style.display = 'block';
                    indicator.innerText = `üî¥ ${data.username} ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç...`;
                    lockScript(id);
                } else {
                    // ‡πÄ‡∏£‡∏≤‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÅ‡∏Å‡πâ‡πÄ‡∏≠‡∏á
                    indicator.style.display = 'none';
                    // unlockScript(id);  <-- ‡∏•‡∏ö‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏ô‡∏µ‡πâ‡∏≠‡∏≠‡∏Å‡∏Ñ‡∏£‡∏±‡∏ö ‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡∏°‡∏±‡∏ô‡∏à‡∏∞‡πÑ‡∏õ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏ä‡πà‡∏≠‡∏á‡∏Å‡∏•‡∏≤‡∏¢‡πÄ‡∏õ‡πá‡∏ô ReadOnly
                }
            } else {
                // ‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÉ‡∏Ñ‡∏£‡πÅ‡∏Å‡πâ
                indicator.style.display = 'none';
                unlockScript(id);
            }
        });
    });
}
function lockScript(id){
    const textarea = document.getElementById('text-' + id);
    const title = document.getElementById('title-' + id);
    const editBtn = document.getElementById('edit-' + id);
    const saveBtn = document.getElementById('save-' + id);
    const cancelBtn = document.getElementById('cancel-' + id);
    const copyBtn = document.querySelector(`#box-${id} .copy-btn`);
    const deleteBtn = document.querySelector(`#box-${id} .delete-btn`);
    
    if(textarea){
        textarea.disabled = true;
        textarea.classList.add('locked');
        textarea.readOnly = true;
    }
    if(title) title.contentEditable = false;
    if(editBtn) editBtn.disabled = true;
    if(saveBtn) saveBtn.disabled = true;
    if(cancelBtn) cancelBtn.disabled = true;
    if(copyBtn) copyBtn.disabled = true;
    if(deleteBtn) deleteBtn.disabled = true;
}

function unlockScript(id){
    const textarea = document.getElementById('text-' + id);
    const title = document.getElementById('title-' + id);
    const editBtn = document.getElementById('edit-' + id);
    const saveBtn = document.getElementById('save-' + id);
    const cancelBtn = document.getElementById('cancel-' + id);
    const copyBtn = document.querySelector(`#box-${id} .copy-btn`);
    const deleteBtn = document.querySelector(`#box-${id} .delete-btn`);
    
    if(textarea){
        textarea.disabled = false;
        textarea.classList.remove('locked');
        textarea.readOnly = true;
    }
    if(editBtn) editBtn.disabled = false;
    if(copyBtn) copyBtn.disabled = false;
    if(deleteBtn) deleteBtn.disabled = false;
}

async function editScript(id){
    const textarea = document.getElementById('text-' + id);
    const title = document.getElementById('title-' + id);
    
    if(!textarea || !title) return;
    
    originalContent[id] = {
        text: textarea.value,
        title: title.innerText
    };
    
    // ‡πÉ‡∏´‡πâ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏û‡∏¥‡∏°‡πÑ‡∏î‡πâ
    textarea.readOnly = false;
    textarea.disabled = false;
    textarea.style.background = 'rgba(20, 50, 100, 0.8)';
    title.contentEditable = true;
    title.style.outline = '2px solid #FFB74D';
    
    const editBtn = document.getElementById('edit-' + id);
    const saveBtn = document.getElementById('save-' + id);
    const cancelBtn = document.getElementById('cancel-' + id);
    
    if(editBtn) editBtn.style.display='none';
    if(saveBtn) saveBtn.style.display='inline-block';
    if(cancelBtn) cancelBtn.style.display='inline-block';
    
    await editingRef.child(id.toString()).set({
        username: currentUser.username,
        timestamp: firebase.database.ServerValue.TIMESTAMP
    });
    
    // ‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå timer ‡πÄ‡∏Å‡πà‡∏≤
    if(lockTimers[id]) clearTimeout(lockTimers[id]);
    if(timerIntervals[id]) clearInterval(timerIntervals[id]);
    
    // ‡∏ï‡∏±‡πâ‡∏á timer ‡πÉ‡∏´‡∏°‡πà
    lockTimers[id] = setTimeout(async () => {
        await editingRef.child(id.toString()).remove();
        cancelEdit(id);
    }, LOCK_TIMEOUT);
    
    // ‡πÄ‡∏û‡∏¥‡πà‡∏° event listener ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö reset timer ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏û‡∏¥‡∏°
    const handleInput = () => resetLockTimer(id);
    textarea.removeEventListener('input', handleInput);
    textarea.addEventListener('input', handleInput);
    title.removeEventListener('input', handleInput);
    title.addEventListener('input', handleInput);
    
    updateLockTimer(id);
}

function resetLockTimer(id){
    // ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å timer ‡πÄ‡∏Å‡πà‡∏≤
    if(lockTimers[id]) clearTimeout(lockTimers[id]);
    
    // ‡∏ï‡∏±‡πâ‡∏á timer ‡πÉ‡∏´‡∏°‡πà
    lockTimers[id] = setTimeout(async () => {
        await editingRef.child(id.toString()).remove();
        cancelEdit(id);
    }, LOCK_TIMEOUT);
    
    // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó display ‡πÉ‡∏´‡∏°‡πà
    updateLockTimer(id);
}

function updateLockTimer(id){
    const lockIndicator = document.getElementById('lock-' + id);
    if(!lockIndicator) return;
    
    // ‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå interval ‡πÄ‡∏Å‡πà‡∏≤
    if(timerIntervals[id]) clearInterval(timerIntervals[id]);
    
    const startTime = Date.now();
    timerIntervals[id] = setInterval(() => {
        const elapsed = Date.now() - startTime;
        const remaining = Math.max(0, LOCK_TIMEOUT - elapsed);
        const seconds = Math.ceil(remaining / 1000);
        
        if(seconds > 0){
            lockIndicator.style.display = 'block';
            lockIndicator.innerHTML = `‚è±Ô∏è ‡∏õ‡∏•‡∏î‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡πÉ‡∏ô <span class="lock-timer">${seconds}</span> ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ (‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡∏±‡∏ö‡πÉ‡∏´‡∏°‡πà)`;
        } else {
            lockIndicator.style.display = 'none';
            clearInterval(timerIntervals[id]);
        }
    }, 100);
}

async function saveScript(id){
    const textarea = document.getElementById('text-' + id);
    const title = document.getElementById('title-' + id);
    if(!textarea || !title) return;
    
    try {
        const updatedScript = {
            id: id,
            title: title.innerText.trim(),
            content: textarea.value
        };
        
        // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏á Firebase
        await scriptsRef.child(id.toString()).set(updatedScript);
        
        // ‡∏õ‡∏£‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡∏´‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å
        textarea.readOnly = true;
        textarea.style.background = 'rgba(10, 10, 10, 0.9)';
        title.contentEditable = false;
        title.style.outline = 'none';
        
        document.getElementById('edit-' + id).style.display='inline-block';
        document.getElementById('save-' + id).style.display='none';
        document.getElementById('cancel-' + id).style.display='none';
        
        await editingRef.child(id.toString()).remove();
        
        // ‡∏•‡πâ‡∏≤‡∏á Timer
        if(lockTimers[id]) clearTimeout(lockTimers[id]);
        if(timerIntervals[id]) clearInterval(timerIntervals[id]);
        if(document.getElementById('lock-' + id)) document.getElementById('lock-' + id).style.display = 'none';

        // ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° "‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß!"
        showMsg('save-msg-' + id); 

    } catch (error) {
        alert("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å: " + error.message);
    }
}

async function cancelEdit(id){
    const textarea = document.getElementById('text-' + id);
    const title = document.getElementById('title-' + id);
    
    if(!textarea || !title) return;
    
    if(originalContent[id]){
        textarea.value = originalContent[id].text;
        title.innerText = originalContent[id].title;
    }
    
    textarea.readOnly = true;
    textarea.disabled = false;
    textarea.style.background = 'rgba(10, 10, 10, 0.9)';
    title.contentEditable = false;
    title.style.outline = 'none';
    
    const editBtn = document.getElementById('edit-' + id);
    const saveBtn = document.getElementById('save-' + id);
    const cancelBtn = document.getElementById('cancel-' + id);
    
    if(editBtn) editBtn.style.display='inline-block';
    if(saveBtn) saveBtn.style.display='none';
    if(cancelBtn) cancelBtn.style.display='none';
    
    await editingRef.child(id.toString()).remove();
    
    if(lockTimers[id]) clearTimeout(lockTimers[id]);
    if(timerIntervals[id]) clearInterval(timerIntervals[id]);
    lockTimers[id] = null;
    timerIntervals[id] = null;
    
    const lockIndicator = document.getElementById('lock-' + id);
    if(lockIndicator) lockIndicator.style.display = 'none';
}

// ====== UTILITY FUNCTIONS ======
// ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÉ‡∏´‡∏°‡πà‡πÉ‡∏´‡πâ‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢‡∏Ç‡∏∂‡πâ‡∏ô
function copyFrom(id){
    const ta = document.getElementById(id);
    if(!ta) return;
    const text = ta.value;

    // ‡∏ß‡∏¥‡∏ò‡∏µ‡∏ó‡∏µ‡πà 1: ‡πÉ‡∏ä‡πâ Clipboard API (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö HTTPS)
    if (navigator.clipboard && window.isSecureContext) {
        navigator.clipboard.writeText(text)
            .then(() => showMsg(id))
            .catch(err => copyFallback(text, id));
    } else {
        // ‡∏ß‡∏¥‡∏ò‡∏µ‡∏ó‡∏µ‡πà 2: ‡πÉ‡∏ä‡πâ‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏™‡∏≥‡∏£‡∏≠‡∏á (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö HTTP ‡∏´‡∏£‡∏∑‡∏≠‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠‡∏£‡∏∏‡πà‡∏ô‡πÄ‡∏Å‡πà‡∏≤)
        copyFallback(text, id);
    }
}

// ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏£‡∏≠‡∏á‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å
function copyFallback(text, id) {
    const textArea = document.createElement("textarea");
    textArea.value = text;
    document.body.appendChild(textArea);
    textArea.select();
    try {
        document.execCommand('copy');
        showMsg(id);
    } catch (err) {
        console.error('‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ:', err);
    }
    document.body.removeChild(textArea);
}

function showMsg(id){ 
    // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏°‡∏µ id-msg ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà (‡πÄ‡∏ä‡πà‡∏ô text-1-msg ‡∏´‡∏£‡∏∑‡∏≠ save-msg-1-msg)
    const msg = document.getElementById(id + '-msg'); 
    if(!msg) return;
    msg.style.display='block';
    setTimeout(() => msg.style.display='none', 2000);
}

function showMsg(id){ 
    const msg = document.getElementById(id + '-msg'); 
    if(!msg) return;
    msg.style.display='block'; 
    setTimeout(() => msg.style.display='none', 2000);
}

function toggleUserTime(){
    const box = document.getElementById('user-time-box');
    box.style.display = (box.style.display==='none' || box.style.display==='')?'block':'none';
}

function startTimer(){
    intervalTimer = setInterval(() => {
        if(!currentUser) return;
        let timeHTML = `‚è±Ô∏è ‡πÄ‡∏ß‡∏•‡∏≤‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡πÄ‡∏ß‡πá‡∏ö: ${Math.floor((new Date()-loginTime)/1000)} ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ<br>`;
        timeHTML += `üïê ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö: ${currentUser.lastLogin}`;
        document.getElementById('user-time-box').innerHTML = timeHTML;
    }, 1000);
}

// ====== AUTO-LOGIN ======
window.onload = async function(){
    startUrlRandomizer(); // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡∏™‡∏∏‡πà‡∏° URL ‡∏ï‡∏≤‡∏°‡∏õ‡∏Å‡∏ï‡∏¥
    
    // ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏à‡∏≤‡∏Å LocalStorage
    const stored = localStorage.getItem("logged_in_user"); 
    
    if(stored){
        try {
            // ‡πÅ‡∏õ‡∏•‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏•‡∏±‡∏ö‡πÄ‡∏õ‡πá‡∏ô Object
            currentUser = JSON.parse(stored); 
            // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï sessionId ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏ä‡∏°‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ô‡∏µ‡πâ
            currentUser.sessionId = sessionId; 
            localStorage.setItem("logged_in_user", JSON.stringify(currentUser));
            
            // ‡∏Ç‡πâ‡∏≤‡∏°‡∏´‡∏ô‡πâ‡∏≤ Login ‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡∏´‡∏ô‡πâ‡∏≤ Script ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
            await showScript(); 
        } catch(e) {
            console.error('Error auto-login:', e);
            showLogin(); // ‡∏´‡∏≤‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏™‡∏µ‡∏¢‡∏´‡∏≤‡∏¢‡πÉ‡∏´‡πâ‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤ Login
        }
    }
}

// ====== CLEANUP ======
window.addEventListener('beforeunload', async () => {
    if(currentUser){
        await onlineRef.child(sessionId).remove();
    }
});
</script>

</body>
</html>
